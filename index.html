<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Creativia Analyzer — Funcional Localhost</title>

<style>
:root{--bg:#0b1018;--panel:#121a28;--text:#ecf3ff;--muted:#9fb0c7;--border:#243049;--brand1:#6a64ff;--brand2:#7b59ff}
*{box-sizing:border-box;font-family:Inter,system-ui}
body{margin:0;background:#0b1018;color:var(--text)}
.wrap{max-width:620px;margin:20px auto;padding:12px}
.card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;display:flex;flex-direction:column;gap:12px}
.btn{padding:12px 16px;background:linear-gradient(90deg,var(--brand1),var(--brand2));border:none;border-radius:12px;color:#fff;font-weight:800;cursor:pointer;width:100%}
.btn.secondary{background:#283553}
.small{color:var(--muted);font-size:12px}
.uploader{border:2px dashed #2a3852;border-radius:14px;height:220px;display:flex;align-items:center;justify-content:center;background:#0c1422;position:relative;overflow:hidden;color:#9fb0c7;text-align:center;padding:10px}
.uploader img{position:absolute;inset:0;object-fit:contain;display:none;width:100%;height:100%}
.kpis{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.kpi{background:#0f1725;border:1px solid #2a3652;border-radius:12px;padding:10px}
.kpi .lbl{font-size:11px;color:#9fb0c7}
.kpi .val{font-size:20px;font-weight:800}
.badge{background:#101a2e;border:1px solid #31405e;padding:6px 10px;border-radius:999px;font-size:11px}
.box{background:#0c1422;border:1px solid #2a3652;border-radius:14px;min-height:330px;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}
.box img{max-width:60%;max-height:60%;object-fit:contain;}
#loader{position:absolute;width:40px;height:40px;border:4px solid var(--brand1);border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite;display:none}
@keyframes spin{to{transform:rotate(360deg)}}
.err{color:#ffbaba;font-size:13px;white-space:pre-wrap}
</style>
</head>

<body>
<div class="wrap">
<h2>Creativia Analyzer</h2>
<p class="small" id="helper">Sube tu anuncio para analizarlo y generar la versión mejorada.</p>

<div class="card">
  <div class="uploader" id="drop">
    <span id="dropHint">Sube tu anuncio (JPG/PNG)</span>
    <img id="preview"/>
    <input id="file" type="file" accept="image/*" style="position:absolute;inset:0;opacity:0;cursor:pointer"/>
  </div>

  <button class="btn" id="analyzeBtn" disabled>Analizar anuncio</button>

  <div class="kpis">
    <div class="kpi"><div class="lbl">Impacto</div><div class="val" id="score">—</div></div>
    <div class="kpi"><div class="lbl">Mejora potencial</div><div class="val" id="improve">—</div></div>
    <div class="kpi" style="grid-column:1/-1"><div class="lbl">Coherencia</div><div class="badge" id="coh">—</div></div>
  </div>

  <div class="small" id="rec">—</div>

  <button class="btn secondary" id="improveBtn" disabled>Generar versión mejorada</button>

  <div class="box"><div id="loader"></div><img id="result"/></div>

  <button class="btn secondary" id="download" disabled>Descargar imagen</button>

  <button class="btn" onclick="window.open('https://calendly.com/hola-creativiaagency/30min','_blank')">Agenda tu reunión con Creativia</button>
  <button class="btn secondary" onclick="window.open('https://wa.me/5491135893606','_blank')">WhatsApp +54 9 11 3589 3606</button>

  <div id="err" class="err"></div>
</div>
</div>

<script>
const $ = id => document.getElementById(id);
let imgURL = '', output = '', improveUsed = false;

$('file').addEventListener('change', e => {
  const f = e.target.files[0];
  if (!f) return;
  const reader = new FileReader();
  reader.onload = () => {
    imgURL = reader.result;
    $('preview').src = imgURL;
    $('preview').style.display = 'block';
    $('dropHint').style.display = 'none';
    $('analyzeBtn').disabled = false;
  };
  reader.readAsDataURL(f);
});

$('analyzeBtn').onclick = () => {
  $('score').textContent = 65;
  $('improve').textContent = "22%";
  $('coh').textContent = "Media";
  $('rec').textContent = "Mejorá la iluminación y contraste";
  $('improveBtn').disabled = false;
};

$('improveBtn').onclick = async () => {

  if (improveUsed) {
    alert("Una sola mejora por sesión.");
    return;
  }
  improveUsed = true;
  $('improveBtn').disabled = true;

  $('loader').style.display = 'block';
  $('err').textContent = '';

  try{
    const res = await fetch("https://analyzer-617099966138.us-central1.run.app/improve", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        imageBase64: imgURL,
        prompt: promptFinal
      })
    });

    const data = await res.json();
    output = "data:image/png;base64," + data.data[0].b64_json;
    $('result').src = output;
    $('download').disabled = false;

  } catch(err){
    $('err').textContent = err.message;
  }

  $('loader').style.display = 'none';
};

const promptFinal = `Objetivo: mostrar un cambio importante manteniendo logo, producto y textos originales.
Fotografía comercial premium con iluminación cinematográfica cálida.
Texturas realistas, reflejos sutiles y acabado editorial de alto nivel.
Podés agregar figuras humanas integradas de manera natural, con expresiones reales y estilo lifestyle cálido.
Escena coherente y natural en un ambiente cotidiano (hogar/café) con profundidad de campo.
El producto debe ser el protagonista del anuncio (hero shot), con presencia dominante en la composición.
Utilizar composición publicitaria siguiendo la regla de tercios.
No inventes textos nuevos; respetá exactamente los textos originales sin modificar ninguna letra.
Colocación natural del producto; sin deformarlo. Logo visible y fiel al original.
CTA no tapa producto ni rostro.
Evitar fondos planos, elementos irreales o artefactos visuales.
Resultado: imagen atractiva, aspiracional, emocional y lista para campaña.
Formato vertical 2:3 (1024×1536).`;

$('download').onclick = () => {
  const a=document.createElement('a');
  a.href=output;
  a.download='creativia_mejorado.png';
  a.click();
};
</script>

</body>
</html>
